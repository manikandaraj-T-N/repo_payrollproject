<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>payslip</title>

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.8.0/html2pdf.bundle.min.js" integrity="sha512-w3u9q/DeneCSwUDjhiMNibTRh/1i/gScBVp2imNVAMCt6cUHIw6xzhzcPFIaL3Q1EbI2l+nu17q2aLJJLo4ZYg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> -->

     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>



    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Quicksand', sans-serif;
        }

        body{
            display: grid;
            grid-template-areas: "sidebar header"
            "sidebar main";
            grid-template-columns: 200px 1fr;
            grid-template-rows: auto 1fr;
            min-height: 100vh;

        }
        nav{
            grid-area: sidebar;
             background-color: #455A64;
            color: white;
            padding-top: 40px;
        }

   nav ul{
    list-style: none;
    margin: 0;
    padding: 0;
   }     

   nav li {
  padding: 15px 20px;
  cursor: pointer;
}

nav li.active {
 color: #F8CC14;
}

nav li:hover {
  background-color: #37474F;
}
nav li a{
  color: white;
  text-decoration: none;
}

nav li a{
    display: flex;
    gap: 5%;
    align-items: baseline;
}


 header{
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
 }

 main{
    grid-area: main;
    padding: 10px;
    
 }
.details{
    display: grid;
    grid-template-columns: 1fr 1fr;
    margin-bottom: 5%;
}

.details p{
    margin-bottom: 2%;
}
 main section{
    /* margin: 5%; */
    background-color: #FEEBAD;
    padding: 5%;
 }

 table{
    border-collapse: collapse;
    padding: 0;
    margin-bottom: 20px;
    border: 1px solid black;
    background-color: #ff7f1681;
    box-sizing: border-box;
 }

 table thead{
  background-color: #F8CC14;
 }
 .payslip-total-earnings{
  text-align: end;
 }
 
 .save-download{
  display: flex;
  gap: 2%;
  margin-top: 5%;
  justify-content: center;
 }

 .save{
  background-color: #F8CC14;
  padding: 5px 10px;
  border-radius: 5px;
  color: white;
  cursor: pointer;
  border: none;
 }
 .download{
  background-color: #455A64;
  color: white;
  padding: 5px 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;

 }
 table thead th{
  padding: 10px;
  text-align: center;
 }
 table td{
  padding: 10px;
  text-align: center;
 }

.recolor {
  width: 10%;
    filter: brightness(0) invert(1);
}

nav li{
    display: flex;
    gap: 5%;
}
  </style>

</head>
<body>

     <nav>
    <ul>
      <li ><a href="./overview.html"><i class="fa-solid fa-palette"></i>Overview</a></li>
      <li ><i class="fa-solid fa-file-invoice-dollar"></i> <a href="./payroll.html">Payroll</a> </li>
      <li class="active"><i class="fa-solid fa-file-invoice-dollar"></i>Payslip</li>
    </ul>
  </nav>


    <header>
    <h2>Payslip Details</h2>
</header>


<main>
    <section class="payslip-data">

  <div class="details">
   
  <p><strong>Employee Name :</strong> <span id="slip-name-text"></span></p>
  <p><strong>Date :</strong> <span id="slip-date-text"></span></p>
  <p><strong>Employee ID :</strong> <span id="slip-id-text"></span></p>
  <p id="slip-month"><strong>Month :</strong> <span id="slip-month-text"></span></p>

  <p><strong>Role : </strong> <span id="slip-role-text"></span></p>
 </div>

<table border="1">
<thead>
  <tr>
    <th colspan="2">Empoyee Details</th>
    <th colspan="3">Days</th>
    <th colspan="2">Earnings</th>
    
    <th>Additions</th>
    <th>Deductions</th>
  </tr>
  <tr>
        <th>Employee Id</th>
        <th>Employee Name</th>
        <th>No of working days</th>
        <th>No of present days</th>
        <th>Leave days</th>
        <th>Basic Salary</th>
        <th>Total Salary</th>
        
        <th></th>
        <th></th>
      </tr>
      </thead>
      <tbody>
  <tr>
    <td id="slip-id"></td>
    <td id="slip-name"></td>

    <td id="slip-workingdays"></td>
    <td id="slip-presentdays"></td>
    <td id="slip-leavedays"></td>

    <td id="slip-basic-sal"></td>
    <td id="slip-originaltotal-sal"></td>
    <td id="slip-addition"></td>
    <td id="slip-deduction"></td>
  </tr>
  </tbody>
</table>


<p class="payslip-total-earnings"><strong>Total Earnings:</strong> <span id="slip-total-earnings"></span></p>
 
 <div class="save-download">
        <button  class="save" id="save">Save</button>
        <button class="download" id="download">Download</button>
    </div>
</section>

</main>


<script>
    window.addEventListener("DOMContentLoaded",function(){

        const empData=JSON.parse(localStorage.getItem("empPayrollData"))
        if(empData){
            document.getElementById("slip-name-text").textContent = empData.name;
            document.getElementById("slip-id-text").textContent = empData.id;
            document.getElementById("slip-role-text").textContent = empData.role;
            document.getElementById("slip-date-text").textContent = empData.date;


  
    const dateObj = new Date(empData.date);
    const monthName = dateObj.toLocaleString("default", { month: "long" });

   
    const monthParagraph = document.createElement("p");
    monthParagraph.innerHTML = `<strong>Month :</strong> ${monthName}`;
    
   
    const detailsDiv = document.querySelector(".details");
    const existingMonthElement = Array.from(detailsDiv.children).find(p => p.textContent.includes("Month :"));
    if (existingMonthElement) {
      detailsDiv.replaceChild(monthParagraph, existingMonthElement);
    } else {
      detailsDiv.insertBefore(monthParagraph, detailsDiv.children[3]); // insert after date
    }



document.getElementById("slip-id").textContent = empData.id;
document.getElementById("slip-name").textContent = empData.name;
document.getElementById("slip-basic-sal").textContent = empData.basicSal;

// document.getElementById("slip-total-sal").textContent = empData.totalSal;

document.getElementById("slip-addition").textContent = empData.addition;
document.getElementById("slip-deduction").textContent = empData.deduction;

document.getElementById("slip-total-earnings").textContent = empData.totalearnings;

document.getElementById("slip-workingdays").textContent=empData.totalworkingdays;
document.getElementById("slip-presentdays").textContent=empData.presentdays;
document.getElementById("slip-leavedays").textContent=empData.leavedays;

document.getElementById("slip-originaltotal-sal").textContent=empData.originalsalary;
    }

    })
</script>


<!--  dynamically download name of pdf file    -->
<script>
  document.getElementById("download").addEventListener("click", function () {
    const element = document.querySelector(".payslip-data");
    const buttons = document.querySelector(".save-download");

    // Hide buttons temporarily
    buttons.style.display = "none";

    // Create temporary heading
    const heading = document.createElement("h1");
    heading.textContent = "Payslip";
    heading.style.textAlign = "center";
    heading.style.marginBottom = "5%";
    heading.style.fontSize = "24px";
    heading.style.color = "#000";
    element.insertBefore(heading, element.firstChild);

    // Get employee name and month from localStorage
    const empData = JSON.parse(localStorage.getItem("empPayrollData"));
    let fileName = "payslip.pdf"; // default fallback

    if (empData) {
      const empName = empData.name?.trim().replace(/\s+/g, "_") || "Employee";
      const dateObj = new Date(empData.date);
      const monthName = dateObj.toLocaleString("default", { month: "long" });
      fileName = `${empName}_${monthName}.pdf`;
    }

    html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');

      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();
      const imgWidth = canvas.width;
      const imgHeight = canvas.height;

      const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
      const imgPdfWidth = imgWidth * ratio;
      const imgPdfHeight = imgHeight * ratio;

      pdf.addImage(imgData, 'PNG', 0, 0, imgPdfWidth, imgPdfHeight);
      pdf.save(fileName); //dynamic name used here

      // Restore UI
      element.removeChild(heading);
      buttons.style.display = "flex";
    });
  });
</script>



<!--     normal download pdf -->
<!-- <script>
  document.getElementById("download").addEventListener("click", function () {
    const element = document.querySelector(".payslip-data");
    const buttons = document.querySelector(".save-download");

    // Hide buttons
    buttons.style.display = "none";

    // Create temporary heading
    const heading = document.createElement("h1");
    heading.textContent = "Payslip";
    heading.style.textAlign = "center";
    heading.style.marginBottom = "5%";
    heading.style.fontSize = "24px";
    heading.style.color = "#000";
    element.insertBefore(heading, element.firstChild);

    html2canvas(element, { scale: 2, useCORS: true }).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');

      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();
      const imgWidth = canvas.width;
      const imgHeight = canvas.height;

      const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
      const imgPdfWidth = imgWidth * ratio;
      const imgPdfHeight = imgHeight * ratio;

      pdf.addImage(imgData, 'PNG', 0, 0, imgPdfWidth, imgPdfHeight);
      pdf.save('payslip.pdf');

      // Cleanup
      element.removeChild(heading);
      buttons.style.display = "flex";
    });
  });
</script> -->


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<div id="print-area" style="display: none; padding: 20px; background-color: #FEEBAD;"></div>

 </body>
 </html>
